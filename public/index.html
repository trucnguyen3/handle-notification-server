<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Safari Push Test</title>
  <!-- TikTok Pixel Code Start -->
  <script>
    !function (w, d, t) {
      w.TiktokAnalyticsObject = t; var ttq = w[t] = w[t] || []; ttq.methods = ["page", "track", "identify", "instances", "debug", "on", "off", "once", "ready", "alias", "group", "enableCookie", "disableCookie", "holdConsent", "revokeConsent", "grantConsent"], ttq.setAndDefer = function (t, e) { t[e] = function () { t.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }; for (var i = 0; i < ttq.methods.length; i++)ttq.setAndDefer(ttq, ttq.methods[i]); ttq.instance = function (t) {
        for (
          var e = ttq._i[t] || [], n = 0; n < ttq.methods.length; n++)ttq.setAndDefer(e, ttq.methods[n]); return e
      }, ttq.load = function (e, n) {
        var r = "https://analytics.tiktok.com/i18n/pixel/events.js", o = n && n.partner; ttq._i = ttq._i || {}, ttq._i[e] = [], ttq._i[e]._u = r, ttq._t = ttq._t || {}, ttq._t[e] = +new Date, ttq._o = ttq._o || {}, ttq._o[e] = n || {}; n = document.createElement("script")
          ; n.type = "text/javascript", n.async = !0, n.src = r + "?sdkid=" + e + "&lib=" + t; e = document.getElementsByTagName("script")[0]; e.parentNode.insertBefore(n, e)
      };


      ttq.load('D1QBHPJC77U4R41UT950');
      ttq.page();
    }(window, document, 'ttq');

    // add this before event code to all pages where PII data postback is expected and appropriate 
    ttq.identify({
      "email": "BFG7000", // string. The email of the customer if available. It must be hashed with SHA-256 on the client side.
      "phone_number": "BFC7000", // string. The phone number of the customer if available. It must be hashed with SHA-256 on the client side.
      "external_id": "" // string. Any unique identifier, such as loyalty membership IDs, user IDs, and external cookie IDs.It must be hashed with SHA-256 on the client side.
    });

    ttq.track('ViewContent', {
      "contents": [
        {
          "content_id": "121", // string. ID of the product. Example: "1077218".
          "content_type": "landing", // string. Either product or product_group.
          "content_name": "test" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "5", // number. Value of the order or items sold. Example: 100.
      "currency": "1" // string. The 4217 currency code. Example: "USD".
    });

    /*
    ttq.track('AddToWishlist', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });

    ttq.track('Search', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>", // string. The 4217 currency code. Example: "USD".
      "search_string": "<search_keywords>" // string. The word or phrase used to search. Example: "SAVE10COUPON".
    });

    ttq.track('AddPaymentInfo', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });

    ttq.track('AddToCart', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });

    ttq.track('InitiateCheckout', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });

    ttq.track('PlaceAnOrder', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });

    ttq.track('CompleteRegistration', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });

    ttq.track('Purchase', {
      "contents": [
        {
          "content_id": "<content_identifier>", // string. ID of the product. Example: "1077218".
          "content_type": "<content_type>", // string. Either product or product_group.
          "content_name": "<content_name>" // string. The name of the page or product. Example: "shirt".
        }
      ],
      "value": "<content_value>", // number. Value of the order or items sold. Example: 100.
      "currency": "<content_currency>" // string. The 4217 currency code. Example: "USD".
    });
    */
  </script>
  <!-- TikTok Pixel Code End -->
</head>

<body>
  <div id="dopContainer"
    style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1001; background-color: rgba(0,0,0,0.6);">
    <div
      style="display:block; opacity: 1.0 !important; position: relative; top: 0px; margin-left:auto; margin-right:auto; z-index: 1000; height: 178px; width: 366px; background: #FFFFFF; box-shadow: 0px 8px 32px -10px #0000004D; border-radius: 6px;">
      <div style="display: block; float: left; height: 64px; width: 329px; margin: 24px 16px 24px 16px;"><img
          id="imgIcon"
          src="https://static.wixstatic.com/media/09c7dc_a7f769f03b1b446ea03302bdbf2ff7f8~mv2.png/v1/crop/x_0,y_95,w_500,h_311/fill/w_103,h_64,al_c,q_95,usm_0.66_1.00_0.01,enc_avif,quality_auto/AKA_MarTechAgency_logo-removebg-preview.png"
          width="64px" height="64px" style="float: left;">
        <div style="display: inline; float: left; height: 64px; width: 254px; margin-left: 10px;">
          <div
            style="font-family: Oracle Sans; font-size: 16px; font-weight: 700; line-height: 20px; letter-spacing: 0em; text-align: left; height: 24px;">
            Hello from AKA Demo</div>
          <div
            style="font-family: Oracle Sans; font-size: 14px; font-weight: 400; line-height: 16px; letter-spacing: 0em; text-align: left; color: #161513B2;">
            Hello from AKA Demo</div>
        </div>
      </div>
      <div style="display: block; float: left; height: 50px; width: 366px; background: #FBF9F8; padding-top:11px;">
        <button id="allowBtn"
          style="float:right; height: 36px; width: 75px; border: 1px solid transparent; border-radius: 4px; background-color: #312D2A; color: #FFFFFF; text-align: center; margin: 10px 16px; font-weight: 700;">Allow</button><button
          id="cancelBtn"
          style="float:right; height: 36px; width: 75px; border: 1px solid transparent; border-radius: 4px; background-color: transparent; text-align: center; margin: 10px 0px; font-weight: 700;">Cancel</button>
      </div>
    </div>
    <script>var modal = document.getElementById("dopContainer"); var allowBtn = document.getElementById("allowBtn"); var spanclose = document.getElementById("cancelBtn"); spanclose.onclick = function () { modal.style.display = "none"; webPushManagerAPI.updatedoubleOptInStats(); }; allowBtn.onclick = function () { modal.style.display = "none"; if (window.webPushManagerAPI) { modal.style.display = "none"; webPushManagerAPI.updatedoubleOptInStats(); webPushManagerAPI.register(); } }; setTimeout(function () { if (window.webPushManagerAPI) { webPushManagerAPI.registerBrowsers("Chrome", "Firefox", "Safari", "OP", "Edg"); if (webPushManagerAPI.showDoubleOptInPrompt()) { modal.style.display = "block"; } } }, 3000);</script>
  </div>

  <script type='text/javascript' id='rsyswpsdk' src='https://api.pushio.com/webpush/sdk/wpIndex_min.js'
    wpconfig='{"appserviceKey":"BLG9jTiQRbXS04VUGFPU6pExuDqe-SxBtQOGeHPDtorrMz9i9ZYLsOyn2pe_dVTBqkZodpG2I4LNmjB0GHmvjHY=","apiKey":"ABEXFEd7Zoqi3vWPKnYTPLuj0","accountToken":"ABEtqAqQ4K843bc6hSQQTqRpA","appver":"0.0.0","apiHost":"https://vjr1qya-webpush.oraclersys.com","lazy":false}'></script>

  <h1>Safari Push Notification Demo</h1>
  <button onclick="requestSafariPush()">Enable Safari Push</button>
  <br />
  <img src="./assets/images/j29nfq39_qr_code.png">

  <script>
    const registrationUrl = "https://test.akadigital.net/push/register"; // Your Node.js backend endpoint

    function requestSafariPush() {
      if (!('safari' in window && 'pushNotification' in window.safari)) {
        alert("Safari Push Notifications are not supported on this browser.");
        return;
      }

      const permissionData = window.safari.pushNotification.permission('web.net.akadigital.test');
      checkRemotePermission(permissionData);
    }

    function checkRemotePermission(permissionData) {
      switch (permissionData.permission) {
        case 'default':
          console.log("Requesting permission...");
          window.safari.pushNotification.requestPermission(
            "https://test.akadigital.net", // webServiceURL
            "web.net.akadigital.test",     // websitePushID
            { userId: "123" },             // user data
            function (permissionData) {
              console.log("Permission:", permissionData.permission);
              if (permissionData.permission === "granted") {
                console.log("Device Token:", permissionData.deviceToken);
              } else {
                console.warn("Permission denied");
              }
            }
          );
          break;

        case 'denied':
          alert("You denied Safari Push Notifications.");
          break;

        case 'granted':
          console.log("Device Token:", permissionData.deviceToken);

          // Register device token with server
          fetch(registrationUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ deviceToken: permissionData.deviceToken })
          })
            .then(res => {
              if (res.ok) {
                alert("Device registered successfully!");
              } else {
                alert("Failed to register device.");
              }
            })
            .catch(err => {
              console.error(err);
              alert("Error registering device.");
            });

          break;
      }
    }
  </script>
</body>

</html>